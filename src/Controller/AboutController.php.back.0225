<?php

namespace App\Controller;

use App\Services\AboutServices;
use Pimcore\Model\DataObject;
use Symfony\Component\HttpFoundation\Request;
use App\Services\CourseServices;

use Pimcore\Model\Document;
use Symfony\Component\HttpFoundation\JsonResponse;
use Symfony\Component\Routing\Annotation\Route;
use function Matrix\trace;

class  AboutController extends BaseController
{
    public function overviewAction(Request $request)
    {
        return $this->render('about/index.html.twig');
    }

    public function indexAction(Request $request){
        return $this->redirect('about/overview');
    }

    public function ourPartnersAction(Request $request)
    {
        $type = 'Our Partners';

//        $list = new AboutServices();
//        $data = $list->getData($type);
        $data = [];
        return $this->render('about/ourPartners/index.html.twig',[
            'list' => $data
        ]);


    }

    public function ourClientsAction(Request $request)
    {

        return $this->render('about/ourClients/index.html.twig');
    }

    public function teamAction(Request $request)
    {
        $dataObj = new DataObject\OurTeam\Listing();
        $dataObj->load();

        $list['Faculty'] = $dataObj->filterByTeamType('Faculty')->load();
        $list['Strategists'] = $dataObj->filterByTeamType('IP Strategists')->load();

        return $this->render('about/team/index.html.twig',[
            'list' => $list

        ]);
    }

    public function contactAction(Request $request)
    {
	    $stateObj = new DataObject\NatureOfEnquire\Listing();

	    $ob = $stateObj->getClass();
	   
	    $states = $ob->getFieldDefinition('state')->getOptions();
	

        return $this->render('about/contact/index.html.twig',[
            'states' => $states
        ]);
    }

/**
     * @Route ("/api/careers")
     * @param Request $request
     * @return JsonResponse|\Symfony\Component\HttpFoundation\Response
     */
    public function careersAction(Request $request)
    {

	
        $dataType = $request->request->get('dataType');
	$num = $request->request->get('num');
	$resourceType = 'Case Studies';

	$list = new DataObject\Career\Listing();

	$list->setOrderKey('releaseDate');
	$list->setOrder('DESC');
			        /*$list->load();*/
	$data['latest'] = $list->filterByLatest(true)->load();

	if ($dataType == 'more'){
		$list->setOffset($num);
		$list->setLimit(6);
		$studies   = $list->filterByLatest(false)->load();
		$result = [];									            
		foreach ($studies as $value){
	
			$result[] = [
				'title' => $value->getTitle(),
			
				'date'  => $value->getReleaseDate(),										
				'id'    => $value->getId(),

				'fullPath' => $value->getFullPath(),

				'video' => $value->getDetailVideo() ? $value->getDetailVideo()->getData() : '' ,

				'videoTime' => $value->getVideoTime(),

				'coverImage' => $value->getCoverImage() ? $value->getCoverImage()

						    ->getThumbnail('CaseStudiesMore')->getPath() : ''

			];

		}

		return new JsonResponse($result);

	}

        return $this->render('about/career/index.html.twig',[
            'list' => $data
        ]);
    }


	/**
     * @Route("/about/career/{articleTile}{id}" ,name="craeer-detail", defaults={"path"=""},requirements={"id"="_\d+"})
     * @param Request $request
     * @param $id
     * @return \Symfony\Component\HttpFoundation\Response
     * @throws \Exception
     */
    public function careerDetailAction(Request $request,$id)
    {
		$id = trim($id,'_');
        $list = [];
        $obj = DataObject\Career::getById($id);
        if ($obj){
            $list['title'] = $obj->getTitle();
            $list['releaseDate'] = $obj->getReleaseDate();
            $list['author'] = $obj->getAuthor();
            $list['authorIcon'] = $obj->getAuthorIcon();
            $list['coverImage'] = $obj->getCoverImage();
            $list['content'] = $obj->getContent();
            $list['videoTime'] = $obj->getVideoTime();
            $list['also'] = $obj->getAlsoList();
            $list['file'] = $obj->getFile();
            $list['video'] = $obj->getDetailVideo();
            $list['checkList'] = $obj->getCheckIndustry();
            $list['fullGuide'] = $obj->getFullGuide();
            $list['listType'] = $obj->getListType();
            $list['resourceType'] = $obj->getResourceType();
            $list['shares'] = $obj->getShares();
            $list['moreContent'] = $obj->getMoreContent();
			$list['interestedTitle'] = $obj->getInterestedTitle();
			$list['industryTitle'] = $obj->getIndustryTitle();
			$list['chineseGuide'] = $obj->getChineseGuide();
            $list['guideTitle'] = $obj->getGuideTitle();

        }

        return $this->render('about/career/detail.html.twig',[
            'list' => $list,
            'sharePage' => $request->getUri()
        ]);
    }

}
